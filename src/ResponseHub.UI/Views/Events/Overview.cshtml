@model Enivate.ResponseHub.UI.Models.Events.EventViewModel

@Html.Partial("_EventJobStats", Model)

<div class="row">
	<div class="col-sm-12">
		<p class="lead">Event duration @Model.DurationString</p>
	</div>
</div>

@if (!Model.Finished)
{
	<div class="row">
		<div class="col-sm-12">
			<p><button class="btn btn-danger btn-icon" data-toggle="modal" data-target="#confirm-finish-event"><i class="fa fa-fw fa-stop-circle-o"></i>Finish event</button></p>
		</div>
	</div>
}

@if (!String.IsNullOrEmpty(Model.Description))
{
	<h4>Description</h4>
	<p>@Model.Description</p>
}

<h3>Jobs</h3>

<table class="table table-striped table-hovered">
	<thead>
		<tr>
			<th width="80">Assigned</th>
			<th width="100">Job number</th>
			<th>Message</th>
			<th width="130">Status</th>
		</tr>
	</thead>
	<tbody>
		@if (Model.Jobs.Count == 0)
		{
			<tr>
				<td colspan="4">No jobs have been added to the event yet.</td>
			</tr>
		}
		@foreach(var job in Model.Jobs)
		{
			<tr>
				<td>
					@if (job.Assigned)
					{
						<center><i class="fa fa-fw fa-check text-primary"></i></center>
					}
				</td>
				<td>@job.JobNumber</td>
				<td><small class="text-muted">@job.MessageBody</small></td>
				<td>
					@if (job.Status == Enivate.ResponseHub.Model.Events.EventJobStatus.Completed)
					{
						<span class="marker-completed">@Html.EnumDescription(job.Status)</span>
					}
					else if (job.Status == Enivate.ResponseHub.Model.Events.EventJobStatus.InProgress)
					{
						<span class="marker-in-progress">@Html.EnumDescription(job.Status)</span>
					}
					else if (job.Status == Enivate.ResponseHub.Model.Events.EventJobStatus.Cancelled)
					{
						<span class="marker-cancelled">@Html.EnumDescription(job.Status)</span>
					}
					else if (job.Status == Enivate.ResponseHub.Model.Events.EventJobStatus.FurtherInformationRequired)
					{
						<span class="marker-requires-info">@Html.EnumDescription(job.Status)</span>
					}
					else
					{
						<span class="">@Html.EnumDescription(job.Status)</span>
					}
					
				</td>
			</tr>
		}
	</tbody>
</table>


<div class="modal fade" id="confirm-finish-event" tabindex="-1" role="dialog" aria-labelledby="confirm-finish-label">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="confirm-cancel-label">Finish event?</h4>
			</div>
			<div class="modal-body">
				<p>Are you sure you wish to finish this event? Once a job is finished, no further jobs will be added and no changes can be made to crews or job assignments.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-link" data-dismiss="modal">Close</button>
				<a href="/events/@Model.Id/finish-event" class="btn btn-danger">Finish event</a>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
</div><!-- /.modal -->